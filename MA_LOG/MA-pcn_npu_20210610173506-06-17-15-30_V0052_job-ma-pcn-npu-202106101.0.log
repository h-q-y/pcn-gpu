do nothing
[Modelarts Service Log]user: uid=1101(work) gid=1101(work) groups=1101(work),1000(HwHiAiUser)
[Modelarts Service Log]pwd: /home/work
[Modelarts Service Log]app_url: s3://pcn/MA-pcn_npu_20210610173506-06-17-15-30/code/
[Modelarts Service Log]boot_file: code/train.py
[Modelarts Service Log]log_url: /tmp/log/MA-pcn_npu_20210610173506-06-17-15-30.log
[Modelarts Service Log]command: code/train.py --data_url=s3://pcn/pcn_dataset/pcn/ --train_url=s3://pcn/MA-pcn_npu_20210610173506-06-17-15-30/output/V0052/
[Modelarts Service Log]local_code_dir: 
[Modelarts Service Log]Training start at 2021-07-17-23:51:53
[Modelarts Service Log][modelarts_create_log] modelarts-pipe found
[ModelArts Service Log]modelarts-pipe: will create log file /tmp/log/MA-pcn_npu_20210610173506-06-17-15-30.log
[Modelarts Service Log]handle inputs of training job
INFO:root:Using MoXing-v1.17.3-8aa951bc
INFO:root:Using OBS-Python-SDK-3.20.7
[ModelArts Service Log][INFO][2021/07/17 23:51:54]: env MA_INPUTS is not found, skip the inputs handler
INFO:root:Using MoXing-v1.17.3-8aa951bc
INFO:root:Using OBS-Python-SDK-3.20.7
[ModelArts Service Log]2021-07-17 23:51:54,784 - modelarts-downloader.py[line:620] - INFO: Main: modelarts-downloader starting with Namespace(dst='./', recursive=True, skip_creating_dir=False, src='s3://pcn/MA-pcn_npu_20210610173506-06-17-15-30/code/', trace=False, type='common', verbose=False)
[Modelarts Service Log][modelarts_logger] modelarts-pipe found
[ModelArts Service Log]modelarts-pipe: will create log file /tmp/log/MA-pcn_npu_20210610173506-06-17-15-30.log
[ModelArts Service Log]modelarts-pipe: will write log file /tmp/log/MA-pcn_npu_20210610173506-06-17-15-30.log
[ModelArts Service Log]modelarts-pipe: param for max log length: 1073741824
[ModelArts Service Log]modelarts-pipe: param for whether exit on overflow: 0
[Modelarts Service Log][INFO] exec pip install
Looking in indexes: http://repo.myhuaweicloud.com/repository/pypi/simple
Collecting lmdb>=0.9 (from -r /home/work/user-job-dir/code/pip-requirements.txt (line 1))
  Downloading http://repo.myhuaweicloud.com/repository/pypi/packages/2f/df/3aea5279753cb8ab0c96dec43106e24f388d4179d5224f6d3e652016c095/lmdb-1.2.1.tar.gz (881kB)
    ERROR: Command errored out with exit status 1:
     command: /usr/local/ma/python3.7/bin/python3.7 -c 'import sys, setuptools, tokenize; sys.argv[0] = '"'"'/tmp/pip-install-dda_obo7/lmdb/setup.py'"'"'; __file__='"'"'/tmp/pip-install-dda_obo7/lmdb/setup.py'"'"';f=getattr(tokenize, '"'"'open'"'"', open)(__file__);code=f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' egg_info --egg-base pip-egg-info
         cwd: /tmp/pip-install-dda_obo7/lmdb/
    Complete output (7 lines):
    py-lmdb: Using bundled liblmdb with py-lmdb patches; override with LMDB_FORCE_SYSTEM=1 or LMDB_PURE=1.
    sh: /usr/bin/patch: No such file or directory
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/tmp/pip-install-dda_obo7/lmdb/setup.py", line 119, in <module>
        raise Exception('Applying patch failed')
    Exception: Applying patch failed
    ----------------------------------------
ERROR: Command errored out with exit status 1: python setup.py egg_info Check the logs for full command output.
/home/work/user-job-dir
[ModelArts Service Log]modelarts-pipe: total length: 1490
[Modelarts Service Log][modelarts_logger] modelarts-pipe found
[ModelArts Service Log]modelarts-pipe: will create log file /tmp/log/MA-pcn_npu_20210610173506-06-17-15-30.log
[ModelArts Service Log]modelarts-pipe: will write log file /tmp/log/MA-pcn_npu_20210610173506-06-17-15-30.log
[ModelArts Service Log]modelarts-pipe: param for max log length: 1073741824
[ModelArts Service Log]modelarts-pipe: param for whether exit on overflow: 0
INFO:root:Using MoXing-v1.17.3-8aa951bc
INFO:root:Using OBS-Python-SDK-3.20.7
[Modelarts Service Log]2021-07-17 23:51:57,879 - WARNING - stdout log /var/log/batch-task/job88b1d88c/job-ma-pcn-npu-202106101/stdout.log is not found
[Modelarts Service Log]2021-07-17 23:51:57,887 - INFO - Ascend Driver: Version=20.2.0
[Modelarts Service Log]2021-07-17 23:51:57,888 - INFO - you are advised to use ASCEND_DEVICE_ID env instead of DEVICE_ID, as the DEVICE_ID env will be discarded in later versions
[Modelarts Service Log]2021-07-17 23:51:57,888 - INFO - particularly, ${ASCEND_DEVICE_ID} == ${DEVICE_ID}, it's the logical device id
[Modelarts Service Log]2021-07-17 23:51:57,888 - INFO - Davinci training command
[Modelarts Service Log]2021-07-17 23:51:57,888 - INFO - ['/usr/bin/python', '/home/work/user-job-dir/code/train.py', '--data_url=s3://pcn/pcn_dataset/pcn/', '--train_url=s3://pcn/MA-pcn_npu_20210610173506-06-17-15-30/output/V0052/']
[Modelarts Service Log]2021-07-17 23:51:57,888 - INFO - Wait for Rank table file ready
[Modelarts Service Log]2021-07-17 23:51:57,888 - INFO - Rank table file (K8S generated) is ready for read
[Modelarts Service Log]2021-07-17 23:51:57,889 - INFO - 
{
    "status": "completed",
    "group_count": "1",
    "group_list": [
        {
            "group_name": "job-ma-pcn-npu-202106101",
            "device_count": "1",
            "instance_count": "1",
            "instance_list": [
                {
                    "pod_name": "job88b1d88c-job-ma-pcn-npu-202106101-0",
                    "server_id": "192.168.0.128",
                    "devices": [
                        {
                            "device_id": "0",
                            "device_ip": "192.1.112.92"
                        }
                    ]
                }
            ]
        }
    ]
}
[Modelarts Service Log]2021-07-17 23:51:57,889 - INFO - Rank table file (C7x)
[Modelarts Service Log]2021-07-17 23:51:57,889 - INFO - 
{
    "status": "completed",
    "version": "1.0",
    "server_count": "1",
    "server_list": [
        {
            "server_id": "192.168.0.128",
            "device": [
                {
                    "device_id": "0",
                    "device_ip": "192.1.112.92",
                    "rank_id": "0"
                }
            ]
        }
    ]
}
[Modelarts Service Log]2021-07-17 23:51:57,890 - INFO - Rank table file (C7x) is generated
[Modelarts Service Log]2021-07-17 23:51:57,890 - INFO - Current server
[Modelarts Service Log]2021-07-17 23:51:57,890 - INFO - 
{
    "server_id": "192.168.0.128",
    "device": [
        {
            "device_id": "0",
            "device_ip": "192.1.112.92",
            "rank_id": "0"
        }
    ]
}
[Modelarts Service Log]2021-07-17 23:51:57,891 - INFO - bootstrap proc-rank-0-device-0
[Modelarts Service Log]2021-07-17 23:51:57,899 - INFO - proc-rank-0-device-0 (pid: 125)
WARNING:tensorflow:From /usr/local/Ascend/tfplugin/latest/tfplugin/python/site-packages/npu_bridge/estimator/npu/npu_optimizer.py:225: The name tf.train.Optimizer is deprecated. Please use tf.compat.v1.train.Optimizer instead.
Traceback (most recent call last):
  File "/home/work/user-job-dir/code/train.py", line 37, in <module>
    from data_util import lmdb_dataflow
  File "/cache/user-job-dir/code/data_util.py", line 29, in <module>
    from tensorpack import dataflow
ModuleNotFoundError: No module named 'tensorpack'
[Modelarts Service Log]2021-07-17 23:52:03,911 - ERROR - proc-rank-0-device-0 (pid: 125) has exited with non-zero code: 1
[Modelarts Service Log]2021-07-17 23:52:03,911 - INFO - Begin destroy training processes
[Modelarts Service Log]2021-07-17 23:52:03,911 - INFO - proc-rank-0-device-0 (pid: 125) has exited
[Modelarts Service Log]2021-07-17 23:52:03,911 - INFO - End destroy training processes
[ModelArts Service Log]modelarts-pipe: total length: 3823
[Modelarts Service Log]Training end with return code: 1
[Modelarts Service Log]upload ascend-log to s3://pcn/MA-pcn_npu_20210610173506-06-17-15-30/log/ascend-log/ at 2021-07-17-23:52:03
upload_tail_log.py -l 2048 -o s3://pcn/MA-pcn_npu_20210610173506-06-17-15-30/log/ascend-log/
[Modelarts Service Log]upload ascend-log end at 2021-07-17-23:52:04
[Modelarts Service Log]Training end at 2021-07-17-23:52:04
[Modelarts Service Log]Training completed.
